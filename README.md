# gal-chat

gal-chat 是一个基于 Spring Boot 和 Vue 3 的 AI 聊天应用，专门用于与《樱之刻》游戏中的女主角本间心铃进行对话。该项目结合了多种 AI 技术，包括 RAG（检索增强生成）、GraphRAG、LoRA 微调模型等，提供了丰富的对话体验。

## 功能特点

- **角色扮演对话**：专门针对《樱之刻》中的本间心铃角色进行优化，提供沉浸式对话体验
- **多模型支持**：支持多种 AI 模型（通义千问、DeepSeek、本地模型等）同时运行，可根据需要选择不同的模型
- **知识增强检索**：通过 GraphRAG 实现知识检索增强，提高回答准确性
- **历史感知对话**：能够理解对话历史，提供连贯的对话体验
- **流式输出响应**：支持流式响应，提供更好的用户体验
- **本地化部署**：支持本地部署，降低运行成本

## 技术架构

### 后端技术栈
- Spring Boot 3.5.4
- Java 17
- LangChain4j
- Maven

### 前端技术栈
- Vue 3
- Vite
- JavaScript

### AI 技术组件

#### 核心模型服务
- **对话生成模型**：基于 vLLM 部署的 LoRA 微调 Qwen3 模型
- **文本嵌入模型**：基于 FastChat 部署的 Qwen3-Embedding-0.6B
- **多模型兼容**：支持通义千问、DeepSeek、本地部署模型等多种模型

#### 知识检索系统
- **GraphRAG 服务**：基于 FastAPI 构建的知识检索服务
- **知识库构建**：基于《樱之刻》游戏内容构建的场景、线路、角色、对话知识库
- **语义检索**：通过 embedding 模型实现高效的语义检索

#### 工作流程
```
用户请求 → Spring Boot 后端 → 查询重写 → GraphRAG 知识检索 → AI 模型生成回答
```

1. 用户通过前端界面发送消息
2. 后端使用大模型对用户问题进行重写，结合对话历史生成更精确的查询语句
3. 通过 GraphRAG API 进行知识库检索
4. 将检索到的知识库内容与原始问题一起传给 AI 模型
5. AI 模型基于问题和知识库内容生成回答
6. 通过流式输出将回答逐步返回给用户

## 系统设计

### 多模型架构
系统采用多模型共存架构，支持灵活切换不同 AI 模型：
- 通义千问模型（云端）
- DeepSeek 模型（云端）
- 本地部署模型

### RAG 增强检索
通过 Retrieval-Augmented Generation (RAG) 技术增强模型回答准确性：
- 使用 GraphRAG 构建基于《樱之刻》内容的知识库
- 实现历史感知的查询重写机制
- 优化检索性能，提高响应速度

### 对话管理
- 支持多轮对话上下文管理
- 实现基于记忆ID的会话隔离
- 流式输出提升用户体验

## 部署说明

需要部署以下模型服务：
1. **对话生成模型**：使用 vLLM 部署 LoRA 微调后的 Qwen3 模型
2. **文本嵌入模型**：使用 FastChat 部署 Qwen3-Embedding-0.6B 模型
3. **GraphRAG 服务**：部署基于 FastAPI 的 GraphRAG 知识检索服务

## API 接口

主要 API 接口：
- `GET /ai/chat`：普通聊天接口
- `GET /ai/stream`：流式输出聊天接口


## 项目结构

```
├── ai-agent-frontend/      # 前端项目
│   └── ai-chat/            # Vue 3 + Vite 应用
├── src/                    # 后端源码
│   ├── main/
│   │   ├── java/
│   │   │   └── com/lilac/
│   │   │       ├── controller/     # 控制器层
│   │   │       ├── ai/             # AI 相关服务
│   │   │       │   ├── model/      # 模型配置
│   │   │       │   ├── rag/        # RAG 相关组件
│   │   │       │   └── tools/      # 工具类
│   │   │       └── AiAgentApplication.java  # 主启动类
│   │   └── resources/      # 配置文件和资源
│   └── test/               # 测试代码
└── README.md               # 项目说明文档
```